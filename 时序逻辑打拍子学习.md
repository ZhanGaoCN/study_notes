# verilog中时序逻辑打拍子

所谓打拍子，其实是在时序逻辑块中设置n个寄存器，利用时序逻辑本拍采样，下一拍赋值的特点，实现移位寄存器，每一拍往后移一位，相当于是深度为n

的流水线。一般打拍子是为了时序布线，多分配几个寄存器可以将布线进行优化，一般打两拍就行，如果不行就继续打拍子

以下面代码为例：

// read
reg [DATA_WIDTH-1:0] dout_reg [0:PIPE_DEPTH];

genvar del_var;
generate
    for (del_var = 0; del_var < PIPE_DEPTH; del_var = del_var + 1) begin
        if (del_var > 0) begin
            always @(posedge clk) begin
                dout_reg[del_var] <= dout_reg[del_var-1];
            end
        end else begin
            if (WRITE_PRIORITY) begin
                always @(posedge clk ) begin
                    if (rden) begin
                        dout_reg[del_var] <= memory[raddress];
                    end
                    if(wren && rden && (waddress == raddress)) begin
                        //write && read;
                        dout_reg[del_var] <= data_in;
                    end
                end 
            end else begin
                always @(posedge clk) begin
                    if(rden) begin
                        dout_reg[del_var] <= memory[raddress];
                    end
                end
            end   
        end
    end
endgenerate

assign data_out = dout_reg[PIPE_DEPTH-1];

写了一个深度为2的移位寄存器（寄存器流水线），在第一拍根据各项判断条件判断输出的dout_reg值应该是多少，第二拍将这个值赋给移位寄存器的下一拍，外围线连接到移位寄存器的最后一拍，这么做其实就是为了时序，其实一拍就能完成逻辑：组合逻辑判断，时序逻辑赋值